<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
    <title>Login Page</title>
    <link rel="stylesheet" href="css/login.css">
</head>
<body>
    <div class="container">
        <!-- Left Section (Image + Branding) -->
        <div class="left-section">
            <div class="branding">
                <h1>Smart Health Monitoring</h1>
                <p>We provide Barangay Health Workers (BHWs) with a digital solution to simplify patient data management and appointment scheduling.
                     Our system automates record-keeping, reducing workload and preventing data loss, so BHWs can focus on delivering quality care 
                     with accurate, organized records.</p>
            </div>
        </div>

        <!-- Right Section (Login Form) -->
        <div class="right-section">
            <div class="login-box">
                <h2>Sign in</h2>
                <form id="loginForm">
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" id="useremail" required>
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="userpassword" required>
                            <span class="toggle-password" onclick="togglePassword()">üëÅ</span>
                        </div>
                    </div>
                    <div class="options">
                        <label><input type="checkbox"> Remember Me</label>
                        <a href="#">Forgot your password?</a>
                    </div>
                    <button type="submit" class="btn">Login</button>
                    <p id="error-message" class="error-message hidden"></p>
                    <div class="register-link">
                        <p>Don't have an account? <a href="register.html" id="registerLink">Register here</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
   function togglePassword() {
    let passwordField = document.getElementById("userpassword");
    passwordField.type = passwordField.type === "password" ? "text" : "password";
}

document.getElementById('loginForm').onsubmit = async function(event) {
    event.preventDefault();

    const email = document.getElementById('useremail').value.trim();
    const password = document.getElementById('userpassword').value.trim();
    const errorMessage = document.getElementById('error-message');

    if (!email || !password) {
        errorMessage.innerText = "Please fill in all fields.";
        errorMessage.classList.remove('hidden');
        return;
    }

    try {
        const response = await fetch('login.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ email: email, password: password })
        });

        const data = await response.json(); // Parse JSON response
        console.log("Parsed JSON:", data);

        if (data.success == 1) { // Convert to number for comparison
            window.location.href = data.redirect_url;
        } else {
            // Show an alert if the account is pending
            if (data.message.includes("pending role")) {
                alert(data.message);
            }
            // Show the error message below the login form
            errorMessage.innerText = data.message || "Invalid credentials, please try again.";
            errorMessage.classList.remove('hidden');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Network Error: ' + error.message);
    }
};

// Ensure register button works properly
document.getElementById("registerLink").addEventListener("click", function(event) {
    event.preventDefault(); // Prevent unintended redirection
    window.location.href = "register.html"; // Redirect to register page
});

    </script>
</body>
</html>
